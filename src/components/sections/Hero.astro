---
import { Icon } from 'astro-icon/components';
import BootSequence from '../effects/BootSequence.tsx';
import PixelParticles from '../effects/PixelParticles.tsx';
import { games } from '../../data/games';

const gameIcons: Record<string, string> = {
  'on-tape-rewind': 'lucide:disc-3',
  'neon-zone': 'lucide:zap',
  'ascending': 'lucide:waves',
};
---

<section id="hero" class="relative min-h-screen flex items-center justify-center overflow-hidden">
  <!-- Boot Sequence (React island, dispatches 'boot-complete' CustomEvent) -->
  <BootSequence client:load />

  <!-- Particle background -->
  <PixelParticles client:visible density={50} />

  <!-- Animated gradient background -->
  <div class="absolute inset-0" aria-hidden="true">
    <!-- Deep base -->
    <div class="absolute inset-0 bg-bg-deep"></div>

    <!-- Radial glow from center -->
    <div class="absolute inset-0 hero-glow opacity-40"></div>

    <!-- Top-down atmospheric gradient -->
    <div class="absolute inset-0 bg-gradient-to-b from-bg-surface/60 via-transparent to-bg-deep"></div>
  </div>

  <!-- Perspective grid floor -->
  <div class="absolute inset-x-0 bottom-0 h-[45%] hero-grid opacity-[0.06]" aria-hidden="true"></div>

  <!-- Vertical light rays -->
  <div class="absolute inset-0 pointer-events-none overflow-hidden" aria-hidden="true">
    <div class="absolute top-0 left-1/4 w-px h-full bg-gradient-to-b from-accent-primary/10 via-accent-primary/3 to-transparent"></div>
    <div class="absolute top-0 right-1/3 w-px h-full bg-gradient-to-b from-accent-secondary/8 via-transparent to-transparent"></div>
  </div>

  <!-- Hero content (hidden until boot completes) -->
  <div
    id="hero-content"
    class="relative z-10 text-center px-6 max-w-5xl mx-auto opacity-0 transition-opacity duration-1000"
  >
    <!-- Logo with glow rings -->
    <div class="mb-8 flex justify-center relative">
      <!-- Outer glow ring -->
      <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-36 h-36 md:w-44 md:h-44 rounded-full border border-accent-primary/10 animate-[glow-pulse_4s_ease-in-out_infinite]"></div>
      <!-- Inner glow ring -->
      <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-28 h-28 md:w-36 md:h-36 rounded-full border border-accent-primary/5 animate-[glow-pulse_4s_ease-in-out_infinite_0.5s]"></div>
      <!-- Vertical studio logo (theme-aware) -->
      <img
        src="/images/logo/pixfork-logo-vertical-dark.svg"
        alt="Pixfork Games"
        class="hero-logo-dark h-36 md:h-44 w-auto animate-[float_6s_ease-in-out_infinite] relative z-10 drop-shadow-[0_0_20px_rgba(226,29,0,0.3)]"
      />
      <img
        src="/images/logo/pixfork-logo-vertical-light.svg"
        alt="Pixfork Games"
        class="hero-logo-light h-36 md:h-44 w-auto animate-[float_6s_ease-in-out_infinite] relative z-10 drop-shadow-[0_0_20px_rgba(226,29,0,0.3)]"
      />
    </div>

    <!-- Decorative separator -->
    <div class="flex items-center justify-center gap-3 mb-6" aria-hidden="true">
      <div class="w-12 h-px bg-gradient-to-r from-transparent to-accent-primary/50"></div>
      <div class="flex gap-1">
        <div class="w-1.5 h-1.5 bg-accent-primary/60 rounded-full"></div>
        <div class="w-1.5 h-1.5 bg-accent-secondary/60 rounded-full"></div>
        <div class="w-1.5 h-1.5 bg-accent-tertiary/60 rounded-full"></div>
      </div>
      <div class="w-12 h-px bg-gradient-to-l from-transparent to-accent-primary/50"></div>
    </div>

    <!-- Tagline -->
    <p class="font-body text-lg md:text-xl text-text-secondary mb-3 tracking-wide">
      Producing really good games for a demanding audience.
    </p>
    <p class="font-mono text-sm text-text-muted mb-12">
      Based in Nesoddtangen, Norway &mdash; Est. 2022
    </p>

    <!-- Game preview cards -->
    <div class="flex flex-wrap justify-center gap-4 mb-12">
      {games.map((game) => (
        <a
          href={`/games/${game.slug}`}
          class="group relative bg-bg-surface/60 backdrop-blur-sm border border-white/5 rounded-sm px-5 py-4 hover:border-current transition-all duration-300 text-left min-w-[180px] max-w-[220px]"
          style={`--card-color: ${game.accentColor}; color: ${game.accentColor}`}
        >
          <div class="flex items-center gap-2 mb-2">
            <Icon name={gameIcons[game.slug] || 'lucide:gamepad-2'} class="w-4 h-4 opacity-60" aria-hidden="true" />
            <span class="font-heading text-xs uppercase tracking-wider truncate">
              {game.title}
            </span>
          </div>
          <p class="text-text-muted text-xs leading-relaxed line-clamp-2">
            {game.tagline}
          </p>
          {game.status === 'coming-soon' && (
            <span class="inline-block mt-2 font-mono text-xs uppercase tracking-wider opacity-70">
              Coming {game.releaseYear}
              <span class="inline-block w-1.5 h-3 bg-current ml-1 animate-[blink-cursor_1s_step-end_infinite]" aria-hidden="true"></span>
            </span>
          )}
          {game.status === 'released' && (
            <span class="inline-block mt-2 font-mono text-xs text-text-muted uppercase tracking-wider">
              {game.platforms.includes('steam') ? 'PC / Console' : 'iOS / Android'}
            </span>
          )}
          <!-- Hover glow -->
          <div class="absolute inset-0 rounded-sm opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none" style={`box-shadow: inset 0 0 20px ${game.accentColor}15, 0 0 15px ${game.accentColor}10`} aria-hidden="true"></div>
        </a>
      ))}
    </div>

    <!-- CTAs -->
    <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
      <a
        href="#games"
        class="pixel-border px-8 py-4 font-heading text-sm text-accent-primary uppercase tracking-wider hover:shadow-[0_0_25px_rgba(226,29,0,0.2)] transition-shadow"
      >
        Explore Our Games
      </a>
      <a
        href="/games/on-tape-rewind"
        class="group flex items-center gap-2 px-6 py-3 border-2 border-game-ontape text-game-ontape font-heading text-sm uppercase tracking-wider hover:bg-game-ontape hover:text-bg-deep transition-all"
      >
        <Icon name="lucide:disc-3" class="w-4 h-4" aria-hidden="true" />
        Wishlist On Tape &lt;&lt; Rewind
      </a>
    </div>
  </div>

  <!-- Scroll indicator -->
  <div class="absolute bottom-8 left-1/2 -translate-x-1/2 animate-[scroll-bounce_2s_ease-in-out_infinite] opacity-0 transition-opacity duration-1000" id="scroll-indicator">
    <div class="flex flex-col items-center gap-2">
      <span class="font-mono text-xs text-text-muted uppercase tracking-widest">Scroll</span>
      <Icon name="lucide:chevron-down" class="w-5 h-5 text-text-muted" aria-hidden="true" />
    </div>
  </div>
</section>

<style>
  .hero-glow {
    background: radial-gradient(ellipse 60% 50% at 50% 40%, rgba(226, 29, 0, 0.08) 0%, rgba(127, 47, 255, 0.04) 40%, transparent 70%);
  }

  .hero-grid {
    background-image:
      linear-gradient(rgba(226, 29, 0, 0.4) 1px, transparent 1px),
      linear-gradient(90deg, rgba(226, 29, 0, 0.4) 1px, transparent 1px);
    background-size: 60px 60px;
    transform: perspective(500px) rotateX(60deg);
    transform-origin: center top;
    mask-image: linear-gradient(to top, transparent, black 30%, black 70%, transparent);
    -webkit-mask-image: linear-gradient(to top, transparent, black 30%, black 70%, transparent);
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .hero-logo-dark { display: block; }
  .hero-logo-light { display: none; }

  :global(html.light) .hero-logo-dark { display: none; }
  :global(html.light) .hero-logo-light { display: block; }

  :global(html.light) .hero-glow {
    background: radial-gradient(ellipse 60% 50% at 50% 40%, rgba(226, 29, 0, 0.05) 0%, rgba(127, 47, 255, 0.02) 40%, transparent 70%);
  }

  :global(html.light) .hero-grid {
    background-image:
      linear-gradient(rgba(226, 29, 0, 0.15) 1px, transparent 1px),
      linear-gradient(90deg, rgba(226, 29, 0, 0.15) 1px, transparent 1px);
  }

  @media (prefers-reduced-motion: reduce) {
    .hero-glow,
    .hero-grid {
      animation: none !important;
    }
  }
</style>

<script>
  function showHero() {
    const hero = document.getElementById('hero-content');
    const scroll = document.getElementById('scroll-indicator');
    if (hero) hero.classList.remove('opacity-0');
    if (scroll) scroll.classList.remove('opacity-0');
  }

  // If already booted this session, show immediately
  if (sessionStorage.getItem('pixfork-booted')) {
    showHero();
  }

  // Listen for boot-complete event from BootSequence
  window.addEventListener('boot-complete', showHero);
</script>
