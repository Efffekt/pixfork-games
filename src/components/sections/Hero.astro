---
import { Icon } from 'astro-icon/components';
import BootSequence from '../effects/BootSequence.tsx';
import { games } from '../../data/games';

const gameIcons: Record<string, string> = {
  'on-tape-rewind': 'lucide:disc-3',
  'neon-zone': 'lucide:zap',
  'ascending': 'lucide:waves',
};
---

<section id="hero" class="relative min-h-screen flex items-center justify-center overflow-hidden bg-bg-deep">
  <!-- Boot Sequence (React island, dispatches 'boot-complete' CustomEvent) -->
  <BootSequence client:load />

  <!-- Flat orthogonal grid -->
  <div class="absolute inset-0 hero-grid" aria-hidden="true"></div>

  <!-- Hero content (hidden until boot completes) -->
  <div
    id="hero-content"
    class="relative z-10 text-center px-6 max-w-5xl mx-auto opacity-0 transition-opacity duration-1000"
  >
    <!-- Logo -->
    <div class="mb-8 flex justify-center">
      <img
        src="/images/logo/pixfork-logo-vertical-dark.svg"
        alt="Pixfork Games"
        class="hero-logo-dark h-36 md:h-48 w-auto"
      />
      <img
        src="/images/logo/pixfork-logo-vertical-light.svg"
        alt="Pixfork Games"
        class="hero-logo-light h-36 md:h-48 w-auto"
      />
    </div>

    <!-- Hard divider -->
    <div class="w-24 h-0.5 bg-accent-primary mx-auto mb-6" aria-hidden="true"></div>

    <!-- Tagline -->
    <p class="text-lg md:text-xl text-text-secondary mb-2 tracking-wide">
      Producing really good games for a demanding audience.
    </p>
    <p class="text-sm text-text-muted mb-12 font-mono">
      Based in Nesoddtangen, Norway &mdash; Est. 2022
    </p>

    <!-- Game preview cards -->
    <div class="flex flex-wrap justify-center gap-4 mb-12">
      {games.map((game) => (
        <a
          href={`/games/${game.slug}`}
          class="group relative bg-bg-surface border-2 px-5 py-4 text-left min-w-[180px] max-w-[220px] transition-all duration-150 hover:-translate-x-0.5 hover:-translate-y-0.5"
          style={`--card-color: ${game.accentColor}; color: ${game.accentColor}; border-color: color-mix(in srgb, ${game.accentColor} 30%, transparent); box-shadow: none;`}
          onmouseenter="this.style.borderColor=this.style.color; this.style.boxShadow='3px 3px 0 ' + this.style.color;"
          onmouseleave={`this.style.borderColor='color-mix(in srgb, ${game.accentColor} 30%, transparent)'; this.style.boxShadow='none';`}
        >
          <div class="flex items-center gap-2 mb-2">
            <Icon name={gameIcons[game.slug] || 'lucide:gamepad-2'} class="w-4 h-4 opacity-60" aria-hidden="true" />
            <span class="font-heading text-xs uppercase tracking-wider truncate">
              {game.title}
            </span>
          </div>
          <p class="text-text-muted text-xs leading-relaxed line-clamp-2">
            {game.tagline}
          </p>
          {game.status === 'coming-soon' && (
            <span class="inline-block mt-2 font-mono text-xs uppercase tracking-wider opacity-70">
              Coming {game.releaseYear}
              <span class="inline-block w-1.5 h-3 bg-current ml-1 animate-[blink-cursor_1s_step-end_infinite]" aria-hidden="true"></span>
            </span>
          )}
          {game.status === 'released' && (
            <span class="inline-block mt-2 font-mono text-xs text-text-muted uppercase tracking-wider">
              {game.platforms.includes('steam') ? 'PC / Console' : 'iOS / Android'}
            </span>
          )}
        </a>
      ))}
    </div>

    <!-- CTAs -->
    <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
      <a
        href="#games"
        class="pixel-border px-8 py-4 font-heading text-sm text-accent-primary uppercase tracking-wider"
      >
        Explore Our Games
      </a>
      <a
        href="/games/on-tape-rewind"
        class="flex items-center gap-2 px-6 py-3 border-2 border-game-ontape text-game-ontape font-heading text-sm uppercase tracking-wider hover:bg-game-ontape hover:text-bg-deep transition-all"
        style="box-shadow: 4px 4px 0 var(--color-game-ontape);"
      >
        <Icon name="lucide:disc-3" class="w-4 h-4" aria-hidden="true" />
        Wishlist On Tape &lt;&lt; Rewind
      </a>
    </div>
  </div>

  <!-- Scroll indicator -->
  <div class="absolute bottom-8 left-1/2 -translate-x-1/2 animate-[scroll-bounce_2s_ease-in-out_infinite] opacity-0 transition-opacity duration-1000" id="scroll-indicator">
    <div class="flex flex-col items-center gap-2 border border-white/15 px-4 py-2">
      <span class="font-mono text-xs text-text-muted uppercase tracking-widest">Scroll</span>
      <Icon name="lucide:chevron-down" class="w-4 h-4 text-text-muted" aria-hidden="true" />
    </div>
  </div>
</section>

<style>
  .hero-grid {
    background-image:
      linear-gradient(rgba(226, 29, 0, 0.06) 1px, transparent 1px),
      linear-gradient(90deg, rgba(226, 29, 0, 0.06) 1px, transparent 1px);
    background-size: 60px 60px;
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .hero-logo-dark { display: block; }
  .hero-logo-light { display: none; }

  :global(html.light) .hero-logo-dark { display: none; }
  :global(html.light) .hero-logo-light { display: block; }

  :global(html.light) .hero-grid {
    background-image:
      linear-gradient(rgba(0, 0, 0, 0.06) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0, 0, 0, 0.06) 1px, transparent 1px);
  }
</style>

<script>
  function showHero() {
    const hero = document.getElementById('hero-content');
    const scroll = document.getElementById('scroll-indicator');
    if (hero) hero.classList.remove('opacity-0');
    if (scroll) scroll.classList.remove('opacity-0');
  }

  if (sessionStorage.getItem('pixfork-booted')) {
    showHero();
  }

  window.addEventListener('boot-complete', showHero);
</script>
